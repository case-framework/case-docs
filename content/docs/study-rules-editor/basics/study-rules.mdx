---
title: Methods of the study engine
description: Actions and expressions supported by the study engine
---

## Study engine

The study engine is the core component of the study running on the server. Its main responsibility is to handle study events based on each study's own rule set.

When a specific event occurs (e.g. a participant submits a survey), the study engine evaluates the participant's data against the study's rules and executes the appropriate actions.
These rules encode the study flow. The engine supports a large set of actions and expressions, providing a high level of freedom in the study design.

**Actions:** typically used to mutate the participant's state, e.g. assign a survey, send a message, create a report, etc.

**Expressions:** typically used to evaluate the participant's state, e.g. check if the participant has a specific flag, check if the participant has answered a specific question, etc.

**Example of a conditional rule:**
- *Condition:* Participant's age is less than 18. -> expression comparing a numeric value against a threshold
- *Action:* Set the participant's age category to *child*. -> action setting a participant flag


## Expressions

### Logical Operators

Logical conditions allow you to combine multiple expressions into more complex rules.
They include **AND, OR, and NOT**, which determine whether all, any, or none of the specified conditions must be true.
**Example:** assign a test kit only if the participant has clicked the Order button **AND** has given consent.

### Comparisons

Comparison conditions check whether a value associated with the participant (e.g., responses, context variables, participant flags, or dates) matches or differs from another value.
The value on the right side can either be a fixed input or another participant associated value.
They include **equals, less than, less than or equal, greater than, and greater than or equal**.
Use these when you want rules to trigger only if study data falls inside or outside specific thresholds.
**Example:** Assign a follow-up survey only if the participant’s age flag is greater than or equal to 18.


### Event Properties

#### 1. **Check event type**
* **Meaning:** True if the event matches a specific type (e.g., submit, timer, custom...).
* **Use Case:** Run action only for certain event categories.
* **How it works:** Select the event type.


#### 2. **Current event is submission of survey with key**
* **Meaning:** True if the event is the submission of a defined survey.
* **Use Case:** Trigger actions only when a specific survey is completed.
* **How it works:** Enter the survey key.


#### 3. **Custom event with key**
* **Meaning:** True if the event is a custom one identified by its key.
* **Use Case:** React to special user actions or system events.
* **How it works:** Provide the custom event key.


#### 4. **Has (any) event payload**
* **Meaning:** True if the event contains additional data.
* **Use Case:** Run actions only when extra information is attached.
* **How it works:** No input required.


#### 5. **Has event payload with key**
* **Meaning:** True if the payload includes a given key.
* **Use Case:** Check for specific structured data in the event.
* **How it works:** Enter the key to check.


#### 6. **Has event payload with key and value**
* **Meaning:** True if the payload contains a key with a matching value.
* **Use Case:** Filter events by exact data content.
* **How it works:** Enter both key and expected value.

### Advanced

#### 1. Is study code present
**Meaning:** True if a specific study code has been assigned to the participant.
**Use case:** Use when actions should only apply to coded participants.
**How it works:** Select the study code to check for.


### Response checkers

#### 1. **Response contains any of these keys**
**Meaning:** True if a participant’s response includes one of the specified keys.
**Use case:** Use when multiple acceptable responses can trigger the rule.
**How it works:** Provide the item key and a list of slot keys.


#### 2. **Has response but none of these keys**
**Meaning:** True if a response exists but excludes specific keys.
**Use case:** Use when certain answers should be filtered out.
**How it works:** Provide the item key and a list of slot keys to exclude.


#### 3. **A specific response key is present**  
* **Meaning:** True if a specific response key is included in the participant’s answer.  
* **Use case:** Use when rules should depend on the presence of a particular question or item.  
* **How it works:** Enter the response item and slot key to check for.


#### 4. **A specific response key is present and has a specific value**
**Meaning:** True if a response key matches a defined value.
**Use case:** Use when precise matching of responses is required.
**How it works:** Provide the item and slot key and enter the expected value.


#### 5. **Check condition for old responses**
**Meaning:** True if past participant responses from older surveys meet the specified condition.
**Use case:** Use when rules should evaluate historical responses, for example to detect repeated patterns.
**How it works:** The condition checks stored responses within an optional time window defined by **"responses since**" and **"responses until"**. You can choose whether **all**, **any**, or a minimum **count** of responses must fulfill the condition.


#### 6. **Consent accepted**
**Meaning:** Checks if the participant has provided consent.
**Use case:** Use when study actions must only apply to consenting participants.
**How it works:** Provide the consent key to check.


### Participant state checkers

#### 1. **Has a survey with key assigned**
* **Meaning:** True if the participant has a specific survey assigned.
* **Use Case:** Check whether a survey is already linked to the participant.
* **How it works:** Enter the survey key.

#### 2. **Is survey in active window (template)**
* **Meaning:** True if the assigned survey is currently available for the participant.
* **Use Case:** Trigger actions only while the survey is available to complete.
* **How it works:** Provide the survey key and the reference time (e.g., current time) to compare it against the survey’s assigned start and end timestamps.

#### 3. **Survey assignment start is before reference time (template)**
* **Meaning:** True if the survey’s assigned start time is earlier than the chosen reference time.
* **Use Case:** Trigger actions only after a survey has become available.
* **How it works:** Provide the survey key and a reference time (e.g., current time or a calculated timestamp). 

#### 4. **Survey assignment end is before reference time (template)**
* **Meaning:** True if the survey’s assigned end time is earlier than the chosen reference time.
* **Use Case:** Trigger actions after a survey’s availability window has ended.
* **How it works:** Provide the survey key and a reference time (e.g., current time or a calculated timestamp). 

#### 5. **Has study status**
* **Meaning:** True if the participant has the defined study status.
* **Use Case:** Apply rules depending on participant’s current study role or status.
* **How it works:** Select the study status (e.g. "active", "inactive", "finished", "exited").

#### 6. **Has participant flag key**
* **Meaning:** This condition evaluates to true if a participant has a flag with the specified key, regardless of its value.  
* **Use Case:** Useful when you want to check if a participant has been assigned a certain flag without caring about what the value is.  
* **How it works:** Enter the key of the participant flag you want to check. 

#### 7. **Has participant flag key and value**
* **Meaning:** True if the participant has a specific flag with a matching value.
* **Use Case:** Target participants based on custom flags or metadata assigned to them.
* **How it works:** Enter both the flag key and expected value to match against participant flags.

#### 8. **Has linking code**
* **Meaning:** True if the participant has been assigned a linking code.
* **Use Case:** Use when rules should apply only to participants connected across studies or systems.
* **How it works:** Select the linking code to check for.

#### 9. **Last submission date is older than**
* **Meaning:** True if the participant’s most recent submission occurred before a specified date.
* **Use Case:** Use to identify inactive participants or trigger reminders after a period of inactivity.
* **How it works:** Enter a cutoff date (and an optional survey key); condition is true if the last submission (of the survey key) is earlier than that date.

#### 10. **Has message type assigned**
* **Meaning:** True if a specific message type has been assigned to the participant.
* **Use Case:** Use when actions should only trigger for participants who are linked to a certain message type (e.g. reminder).
* **How it works:** Select the message type to check for.

### Incoming participant state checkers (for merge events)

#### 1. **Incoming state has survey with key assigned (Merge event)**
* **Meaning:** True if the temporary participant state being merged includes a survey with the specified key.
* **Use Case:**  Handle cases where merged participants bring survey assignments that need to be processed or validated.
* **How it works:** Enter the survey key.

#### 2. **Has incoming study status (Merge event)**
* **Meaning:** True if the incoming participant has a specific study status assigned.
* **Use Case:** Apply rules only when the incoming participant had a defined study status (active, inactive, finished or exited).
* **How it works:** Select the study status (e.g. "active", "inactive", "finished", "exited").

#### 3. **Has incoming participant flag key and value (Merge event)**
* **Meaning:** True if the incoming participant has a flag with the specified key and value.
* **Use Case:** Use when merging should consider specific flags states from the incoming account.
* **How it works:** Enter the flag key and value.


#### 4. **Has incoming participant flag key (Merge event)**
* **Meaning:** True if the incoming participant has a specific flag key defined, regardless of its value.
* **Use Case:** Use when the presence of a flag alone should affect merge actions.
* **How it works:** Enter the flag key.


#### 5. **Incoming last submission date is older than (Merge event)**
* **Meaning:** True if the incoming participant’s last submission occurred before a specified date.
* **Use Case:** Handle merges differently based on how recently the incoming participant was active.
* **How it works:** Enter a cutoff date (and an optional survey key); condition is true if the incoming last submission (of the survey key) is earlier than that.


#### 6. **Has incoming message type assigned (Merge event)**
* **Meaning:** True if the incoming (temporary) participant has a specific message type assigned.
* **Use Case:** Use when actions should only apply if the incoming account already carried a certain message type (e.g., invitation, reminder).
* **How it works:** Select the message type to check for.


#### 7. **Has incoming linking code (Merge event)**
* **Meaning:** True if the incoming participant has a linking code assigned.
* **Use Case:** Apply rules that depend on participants already being linked across studies or external system connections.
* **How it works:** Select the linking code to check for.

## Numbers and Dates

Some expressions return numbers and dates that can e.g. be used for comparisons. Note that Dates are always represented in **Unix timestamp format**, which means they are also integer numbers.  

### Variables

#### 1. **Date picker**  
* **Meaning:** Provides a manual way to select and return a specific date.  
* **Use Case:** Useful if you want to compare against or calculate with a fixed date.  
* **How it works:** Select a date from a calendar interface.

#### 2. **Number input**
* **Meaning:** Allows you to input a fixed numeric value.
* **Use Case:** Useful when you need a constant number for comparisons or calculations.
* **How it works:** Enter the desired numeric value directly.


### Mathematical Operators

#### 1. **Sum**  
* **Meaning:** Adds together multiple numeric values or expressions.  
* **Use Case:** Useful for scoring systems or aggregating responses.  
* **How it works:** All selected values are summed and returned as one number.  

#### 2. **Negation**  
* **Meaning:** Multiplies a number by –1 to invert its sign.  
* **Use Case:** Useful when working with negative offsets or balancing scores.  
* **How it works:** The input value is returned as its negative equivalent.  


### Event properties

#### 1. **Get event payload value as number**  
* **Meaning:** Extracts a value from an event payload and returns it as a number.  
* **Use Case:** Use when incoming event data needs to be used in numeric comparisons or calculations.  
* **How it works:** Enter the key of the event payload.

### Misc

#### 1. **Get timestamp**  
* **Meaning:** Returns a timestamp based on the current date and time or a defined reference date.  
* **Use Case:** Useful for scheduling, comparing deadlines, or calculating relative dates (e.g., setting a reminder 7 days after survey submission).  
* **How it works:**  
  - **Offset:** Add or subtract time (e.g., +3 days, -2 weeks) from the reference point.  
  - **Reference date:** Define a custom date/time as the starting point. If none is provided, the current time is used.  

#### 2. **Parse value as number**  
* **Meaning:** Converts a given value (e.g., a flag or response value) into a numeric value.  
* **Use Case:** Helpful when participant input needs to be treated as a number for calculations or comparisons.  
* **How it works:** Enter the value to be parsed into a number.  

### Advanced

#### 1. **Use external service to evaluate event data (return float)**  
* **Meaning:** Sends event data to an external service, which returns a floating-point number.  
* **Use Case:** Can be used for advanced calculations or evaluations that require external logic.  
* **How it works:** Select service name and route of the external event handler service.

#### 2. **Generate random number**  
* **Meaning:** Produces a random number within a defined range.  
* **Use Case:** Useful for randomization tasks, such as assigning participants to different study groups.  
* **How it works:** Enter a minimum and maximum value. The expression will return a random number within this range.

### Date helpers

#### 1. **Get ISO week for timestamp**  
* **Meaning:** Returns the ISO week number for a given timestamp.  
* **Use Case:** Helpful when rules depend on the calendar week (e.g., weekly schedules or reporting).  
* **How it works:** Provide a timestamp.

#### 2. **Get timestamp for next occurrence of an ISO week**  
* **Meaning:** Calculates the timestamp for the next occurrence of a specified ISO week number.  
* **Use Case:** Useful for scheduling events or reminders based on calendar weeks.  
* **How it works:** Provide an ISO week number (e.g., 42), and the expression returns the timestamp for the start of that week in the current or next year.

#### 3. **Get timestamp for next occurrence of a start of month**  
* **Meaning:** Returns the timestamp for the next start of a specified month.  
* **Use Case:** Ideal for monthly scheduling, e.g., sending out surveys at the beginning of each month.  
* **How it works:** Specify the month (e.g., March), and the expression calculates the timestamp for the next occurrence of the first day of that month.


### Response Checkers

#### 1. **Get response value as number**  
* **Meaning:** Extracts a numeric value from a participant’s response.  
* **Use Case:** Use when responses need to be evaluated numerically, e.g., for scoring or thresholds.  
* **How it works:**  Enter the item key and the slot key of the response.

#### 2. **Count response items**  
* **Meaning:** Counts the number of items in a multi-select or list-type response.  
* **Use Case:** Useful for determining how many options a participant selected.  
* **How it works:** Enter the item key and the slot key of the list response. The slot key refers to the response group that contains the list of selected item options whose count will be evaluated.


### Participant State Checkers

#### 1. **Get study entry time**  
* **Meaning:** Returns the timestamp marking the participant’s entry into the study.  
* **Use Case:** Useful for calculating durations, deadlines, or eligibility based on study entry.  
* **How it works:** No input required.

#### 2. **Get survey key assigned from timestamp**  
* **Meaning:** Retrieves the timestamp from which a specific survey was assigned to the participant.  
* **Use Case:** Useful for determining when a survey became available or tracking assignment history.  
* **How it works:** Enter the survey key. 

#### 3. **Get survey key assigned until timestamp**  
* **Meaning:** Retrieves the timestamp until which a specific survey remains assigned to the participant.  
* **Use Case:** Useful for checking survey availability windows or expiration. 
* **How it works:** Enter the survey key. 

#### 4. **Get participant flag value as number**  
* **Meaning:** Converts a participant flag value into a number.  
* **Use Case:** Useful for evaluating participant flags numerically, e.g., numerical comparison or progress tracking.  
* **How it works:** Provide the flag key. 

#### 5. **Get last submission date**  
* **Meaning:** Returns the timestamp of the participant’s most recent survey submission.  
* **Use Case:** Useful for tracking activity or triggering follow-ups.  
* **How it works:** Specify the survey key. The expression returns the timestamp of the last submission for that survey.

#### 6. **Get message next time**  
* **Meaning:** Retrieves the next timestamp for when a specific message is scheduled to be sent.  
* **Use Case:** Useful for managing message timing, reminders, or notifications.  
* **How it works:** Enter the message key. 


### Incoming Participant State Checkers (Merge Events)

#### 1. **Get incoming study entry time**  
* **Meaning:** Retrieves the study entry timestamp of the incoming (merged) participant.  
* **Use Case:** Useful for comparing entry times or preserving historical context during a merge.  
* **How it works:** No input required. 

#### 2. **Get incoming survey key assigned from timestamp (Merge event)**  
* **Meaning:** Returns the timestamp from which a specific survey was assigned to the incoming participant.  
* **Use Case:** Useful for tracking survey availability prior to a merge.  
* **How it works:** Enter the survey key. 

#### 3. **Get incoming survey key assigned until timestamp (Merge event)**  
* **Meaning:** Returns the timestamp until which a specific survey was assigned to the incoming participant.  
* **Use Case:** Useful for checking if a survey was still active at the time of merge.  
* **How it works:** Enter the survey key. 

#### 4. **Get incoming last submission date (Merge event)**  
* **Meaning:** Retrieves the timestamp of the last survey submission made by the incoming participant.  
* **Use Case:** Useful for evaluating recent activity before the merge.  
* **How it works:** Enter the survey key. 

#### 5. **Get incoming message next time (Merge event)**  
* **Meaning:** Returns the next scheduled time for a message assigned to the incoming participant.  
* **Use Case:** Useful for preserving message timing or rescheduling after a merge.  
* **How it works:** Enter the message key.



## Actions