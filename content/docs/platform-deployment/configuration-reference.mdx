---
title: Configuration Reference
description: This document provides a comprehensive reference for all configuration variables and environment variables used across all services and jobs in the CASE Backend system.
---

# CASE Backend Configuration Reference

This document provides a comprehensive reference for all configuration variables and environment variables used across all services and jobs in the CASE Backend system.

## Global Configuration Pattern

All services and jobs follow a consistent configuration pattern:

1. **Configuration File**: Specified via `CONFIG_FILE_PATH` environment variable
2. **Base Configuration**: Loaded from YAML file
3. **Secret Overrides**: Environment variables override sensitive values from the config file
4. **Initialization**: Services apply overrides during startup

### Required Environment Variable (All Services/Jobs)

**`CONFIG_FILE_PATH`** - Absolute path to the YAML configuration file

> **Note**: This is the only required environment variable for all services and jobs. All other variables are optional and will use values from the configuration file if not provided.

### Environment Variable Precedence

1. Environment variables (highest priority)
2. Configuration file values
3. Default values (lowest priority)

---

## Common Configuration Structures

### Logging Configuration

All services and jobs use the same logging configuration structure:

```yaml
logging:
  log_level: "info" # debug, info, warn, error
  include_src: true # Include source file information
  log_to_file: true # Write logs to file
  filename: "service.log" # Log file name
  max_size: 100 # Max file size in MB
  max_age: 28 # Max age in days
  max_backups: 3 # Max number of backups
  compress_old_logs: true # Compress old log files
  include_build_info: "once" # never, once, always
```

### Database Configuration

Standard database configuration structure used across all services:

```yaml
db_configs:
  database_name:
    connection_str: "connection_string"
    username: "username" # Can be overridden by env var
    password: "password" # Can be overridden by env var
    connection_prefix: ""
    timeout: 30 # Connection timeout in seconds
    idle_conn_timeout: 45 # Idle connection timeout
    max_pool_size: 4 # Max connection pool size
    use_no_cursor_timeout: false # MongoDB specific setting
    db_name_prefix: "" # Database name prefix
    run_index_creation: false # Auto-create indexes
```

### Gin Web Server Configuration

Used by API services:

```yaml
gin_config:
  debug_mode: false # Enable debug mode
  allow_origins: [] # CORS allowed origins
  port: "8080" # HTTP server port
  mtls: # Mutual TLS (Management API only)
    use: false
    certificate_paths:
      ca_cert: ""
      server_cert: ""
      server_key: ""
```

### Study Configuration

Used by services that interact with studies:

```yaml
study_configs:
  global_secret: "global_secret" # Global secret for study operations
  external_services: # External service integrations
    - name: "service-name"
      url: "https://api.service.com"
      api_key: "service_api_key"
      timeout: 30
```

### Messaging Configuration

Used by services that send messages:

```yaml
messaging_configs:
  smtp_bridge_config:
    url: "https://smtp-bridge.example.com"
    api_key: "smtp_bridge_api_key"
    request_timeout: "30s"
  sms_config:
    api_key: "sms_api_key"
    url: "https://sms.gateway.com"
  global_email_template_constants:
    app_name: "Application Name"
    support_email: "support@example.com"
    base_url: "https://app.example.com"
```

---

## Services

### Management API

**Location**: `services/management-api/`

#### Environment Variables

| Variable                                         | Description                                    | Type    | Default     |
| ------------------------------------------------ | ---------------------------------------------- | ------- | ----------- |
| `GIN_DEBUG_MODE`                                 | Enable Gin debug mode                          | boolean | false       |
| `MANAGEMENT_API_LISTEN_PORT`                     | API server port                                | string  | from config |
| `CORS_ALLOW_ORIGINS`                             | Comma-separated CORS origins                   | string  | from config |
| `FILESTORE_PATH`                                 | File storage directory path                    | string  | from config |
| `MANAGEMENT_USER_JWT_SIGN_KEY`                   | JWT signing key for management users           | string  | from config |
| `MANAGEMENT_USER_JWT_EXPIRES_IN`                 | JWT expiration duration (e.g., "24h")          | string  | from config |
| `INSTANCE_IDS`                                   | Comma-separated list of allowed instance IDs   | string  | from config |
| `STUDY_DB_USERNAME`                              | Study database username                        | string  | from config |
| `STUDY_DB_PASSWORD`                              | Study database password                        | string  | from config |
| `PARTICIPANT_USER_DB_USERNAME`                   | Participant user database username             | string  | from config |
| `PARTICIPANT_USER_DB_PASSWORD`                   | Participant user database password             | string  | from config |
| `GLOBAL_INFOS_DB_USERNAME`                       | Global infos database username                 | string  | from config |
| `GLOBAL_INFOS_DB_PASSWORD`                       | Global infos database password                 | string  | from config |
| `MESSAGING_DB_USERNAME`                          | Messaging database username                    | string  | from config |
| `MESSAGING_DB_PASSWORD`                          | Messaging database password                    | string  | from config |
| `MANAGEMENT_USER_DB_USERNAME`                    | Management user database username              | string  | from config |
| `MANAGEMENT_USER_DB_PASSWORD`                    | Management user database password              | string  | from config |
| `STUDY_GLOBAL_SECRET`                            | Global secret for study operations             | string  | from config |
| `EXTERNAL_SERVICE_API_KEY_FOR_{NORMALIZED_NAME}` | API key for external service (dynamic pattern) | string  | from config |

#### YAML Configuration Structure

> **Note**: For common configuration structures (logging, database connections, etc.), see [Common Configuration Structures](#common-configuration-structures) section.

```yaml
# Standard logging configuration (see Common Configuration Structures for details)
logging:
  log_level: "info"
  filename: "management-api.log"
  # ... (standard logging options)

# Standard Gin web server configuration
gin_config:
  debug_mode: false
  port: "8080"
  mtls: # Mutual TLS (unique to Management API)
    use: false # Enable mutual TLS authentication
    certificate_paths:
      ca_cert: "" # Path to CA certificate for client verification
      server_cert: "" # Path to server certificate
      server_key: "" # Path to server private key

# JWT configuration for management user authentication
management_user_jwt_sign_key: "key" # Secret key for signing JWT tokens (override with env var)
management_user_jwt_expires_in: "1h" # JWT token expiration time (e.g., "1h", "30m", "24h")

# List of instance IDs that this management API can manage
allowed_instance_ids:
  - "default" # Instance ID - usually represents different environments/tenants

# All database configurations (see Common Configuration Structures for individual db structure)
db_configs:
  study_db: {} # Study data database
  participant_user_db: {} # Participant user accounts
  global_infos_db: {} # Global information database
  messaging_db: {} # Messaging and notifications
  management_user_db: {} # Management user accounts (unique to Management API)

# Study engine configuration
study_configs:
  global_secret: "global_secret" # Global secret for study operations (override with STUDY_GLOBAL_SECRET)
  external_services: [] # External service integrations (see Common Configuration Structures)

# File storage configuration
filestore_path: "/path/to/filestore" # Path where uploaded files are stored
daily_file_export_path: "/path/to/exports" # Path where daily export files are stored
```

---

### Participant API

**Location**: `services/participant-api/`

#### Environment Variables

| Variable                                         | Description                                    | Type   | Default     |
| ------------------------------------------------ | ---------------------------------------------- | ------ | ----------- |
| `STUDY_DB_USERNAME`                              | Study database username                        | string | from config |
| `STUDY_DB_PASSWORD`                              | Study database password                        | string | from config |
| `PARTICIPANT_USER_DB_USERNAME`                   | Participant user database username             | string | from config |
| `PARTICIPANT_USER_DB_PASSWORD`                   | Participant user database password             | string | from config |
| `GLOBAL_INFOS_DB_USERNAME`                       | Global infos database username                 | string | from config |
| `GLOBAL_INFOS_DB_PASSWORD`                       | Global infos database password                 | string | from config |
| `MESSAGING_DB_USERNAME`                          | Messaging database username                    | string | from config |
| `MESSAGING_DB_PASSWORD`                          | Messaging database password                    | string | from config |
| `PARTICIPANT_USER_JWT_SIGN_KEY`                  | JWT signing key for participants               | string | from config |
| `STUDY_GLOBAL_SECRET`                            | Global secret for study operations             | string | from config |
| `SMTP_BRIDGE_API_KEY`                            | SMTP bridge API key                            | string | from config |
| `SMS_GATEWAY_API_KEY`                            | SMS gateway API key                            | string | from config |
| `EXTERNAL_SERVICE_API_KEY_FOR_{NORMALIZED_NAME}` | API key for external service (dynamic pattern) | string | from config |

#### YAML Configuration Structure

> **Note**: For common configuration structures, see [Common Configuration Structures](#common-configuration-structures) section.

```yaml
# Standard logging configuration (see Common Configuration Structures)
logging:
  filename: "participant-api.log" # Service-specific log file name
  # ... (standard logging options)

# Standard Gin web server configuration (no mTLS support)
gin_config:
  debug_mode: false
  port: "8080"
  # ... (standard gin options, no mTLS)

# Database configurations (excludes management_user_db)
db_configs:
  study_db: {} # Study data database
  participant_user_db: {} # Participant user accounts
  global_infos_db: {} # Global information database
  messaging_db: {} # Messaging and notifications

# User management configuration for participants
user_management_config:
  participant_user_jwt_config: # JWT configuration for participant authentication
    sign_key: "jwt_sign_key" # JWT signing key (override with PARTICIPANT_USER_JWT_SIGN_KEY)
    expires_in: "24h" # JWT token expiration time
  pw_hashing: # Password hashing configuration using Argon2
    argon2_memory: 32768 # Memory usage in KB for Argon2 hashing
    argon2_iterations: 3 # Number of iterations for Argon2 hashing
    argon2_parallelism: 2 # Parallelism factor for Argon2 hashing
    argon2_salt_length: 16 # Salt length in bytes
    argon2_key_length: 32 # Output key length in bytes

# Study engine configuration (see Common Configuration Structures)
study_configs:
  global_secret: "global_secret" # Global secret for study operations
  external_services: [] # External service integrations

# File storage path for participant uploaded files
filestore_path: "/path/to/participant/files" # Directory where participant files are stored

# Messaging configuration (see Common Configuration Structures for details)
messaging_configs:
  smtp_bridge_config:
    url: "https://smtp-bridge.example.com"
    api_key: "smtp_bridge_api_key" # Override with SMTP_BRIDGE_API_KEY
    request_timeout: "30s"
  sms_config: # SMS gateway configuration (optional)
    api_key: "sms_api_key" # Override with SMS_GATEWAY_API_KEY
    url: "https://sms.gateway.com"
  global_email_template_constants: # Global constants for email templates
    app_name: "App Name"
    support_email: "support@example.com"
    base_url: "https://app.example.com"
```

---

### SMTP Bridge

**Location**: `services/smtp-bridge/`

#### Environment Variables

| Variable                                                       | Description                            | Type   | Default     |
| -------------------------------------------------------------- | -------------------------------------- | ------ | ----------- |
| `API_KEYS`                                                     | Comma-separated list of API keys       | string | from config |
| `SMTP_SERVER_USERNAME_FOR_{NORMALIZED_HOST}_{NORMALIZED_PORT}` | SMTP server username (dynamic pattern) | string | from config |
| `SMTP_SERVER_PASSWORD_FOR_{NORMALIZED_HOST}_{NORMALIZED_PORT}` | SMTP server password (dynamic pattern) | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "smtp-bridge.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Gin web server configuration
gin_config:
  debug_mode: false # Enable Gin debug mode (verbose routing info)
  allow_origins: # CORS allowed origins - list of domains that can access this service
    - "https://api.example.com" # Example allowed origin (API services)
    - "https://management.example.com" # Example allowed origin (management interface)
  port: "8080" # HTTP server port to listen on

# API keys for securing access to the SMTP bridge service
api_keys: # List of valid API keys (override with API_KEYS env var)
  - "secure_api_key_1" # API key 1 - used by services to authenticate
  - "secure_api_key_2" # API key 2 - backup or different service key

# SMTP server configuration with priority levels for email routing
smtp_server_config:
  high_prio: # High priority servers (used for critical/urgent emails)
    from: '"System Notifications" <noreply@example.com>' # Default "From" header for high-priority emails
    sender: "system@example.com" # Default "Sender" header (envelope sender)
    replyTo: # Default "Reply-To" addresses for responses
      - "support@example.com" # Where replies should go
    servers: # List of SMTP servers for high-priority emails
      - host: "smtp.gmail.com" # SMTP server hostname
        port: "587" # SMTP server port (587 for TLS, 25 for plain)
        connections: 1 # Max concurrent connections to this server
        insecureSkipVerify: false # Skip TLS certificate verification (use with caution)
        sendTimeout: 30 # Timeout for sending emails in seconds
        auth: # SMTP authentication credentials
          user: "smtp_username" # Username (override with SMTP_SERVER_USERNAME_FOR_SMTP_GMAIL_COM_587)
          password: "smtp_password" # Password (override with SMTP_SERVER_PASSWORD_FOR_SMTP_GMAIL_COM_587)
      - host: "smtp.sendgrid.net" # Additional SMTP server for redundancy
        port: "587"
        connections: 4 # Higher connection limit for bulk sending
        insecureSkipVerify: false
        sendTimeout: 30
        auth:
          user: "apikey" # SendGrid uses "apikey" as username
          password: "sendgrid_api_key" # Actual API key as password

  low_prio: # Low priority servers (used for bulk/non-critical emails)
    from: '"Bulk Notifications" <bulk@example.com>' # Default "From" header for low-priority emails
    sender: "bulk@example.com" # Default "Sender" header for bulk emails
    replyTo: # Default "Reply-To" addresses for bulk emails
      - "no-reply@example.com" # Usually no-reply for bulk emails
    servers: # List of SMTP servers for low-priority emails
      - host: "smtp.mailgun.org" # Mailgun SMTP server
        port: "587"
        connections: 2 # Lower connection limit for bulk
        insecureSkipVerify: false
        sendTimeout: 60 # Longer timeout for bulk sending
        auth:
          user: "postmaster@mg.example.com" # Mailgun username format
          password: "mailgun_password" # Mailgun password
      - host: "smtp-relay.internal.com" # Internal relay server
        port: "25" # Standard SMTP port (no encryption)
        connections: 2
        insecureSkipVerify: true # Internal server may not have valid cert
        sendTimeout: 60
        auth:
          user: "" # No authentication for internal relay
          password: "" # No password required
```

---

### SMTP Bridge Emulator

**Location**: `services/smtp-bridge-emulator/`

#### Environment Variables

| Variable   | Description                      | Type   | Default     |
| ---------- | -------------------------------- | ------ | ----------- |
| `API_KEYS` | Comma-separated list of API keys | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "smtp-bridge-emulator.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Gin web server configuration
gin_config:
  debug_mode: false # Enable Gin debug mode (verbose routing info)
  allow_origins: [] # CORS allowed origins (empty = none allowed)
  port: "8080" # HTTP server port to listen on

# API keys for securing access to the SMTP bridge emulator
api_keys: # List of valid API keys (override with API_KEYS env var)
  - "api_key_1" # API key for authentication

# Directory where email files will be stored as .eml files
emails_dir: "/path/to/store/emails" # Directory to store .eml files (must exist and be writable)
```

---

## Jobs

### Messaging Job

**Location**: `jobs/messaging/`

#### Environment Variables

| Variable                       | Description                        | Type   | Default     |
| ------------------------------ | ---------------------------------- | ------ | ----------- |
| `STUDY_DB_USERNAME`            | Study database username            | string | from config |
| `STUDY_DB_PASSWORD`            | Study database password            | string | from config |
| `PARTICIPANT_USER_DB_USERNAME` | Participant user database username | string | from config |
| `PARTICIPANT_USER_DB_PASSWORD` | Participant user database password | string | from config |
| `GLOBAL_INFOS_DB_USERNAME`     | Global infos database username     | string | from config |
| `GLOBAL_INFOS_DB_PASSWORD`     | Global infos database password     | string | from config |
| `MESSAGING_DB_USERNAME`        | Messaging database username        | string | from config |
| `MESSAGING_DB_PASSWORD`        | Messaging database password        | string | from config |
| `SMTP_BRIDGE_API_KEY`          | SMTP bridge API key                | string | from config |
| `STUDY_GLOBAL_SECRET`          | Global secret for study operations | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "messaging.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Database connection configurations
db_configs:
  participant_user_db: # Participant user accounts database
    connection_str: "connection_string" # MongoDB connection string (host:port)
    username: "username" # Database username (override with PARTICIPANT_USER_DB_USERNAME)
    password: "password" # Database password (override with PARTICIPANT_USER_DB_PASSWORD)
    connection_prefix: "" # Connection string prefix (usually empty)
    timeout: 30 # Connection timeout in seconds
    idle_conn_timeout: 45 # Idle connection timeout in seconds
    max_pool_size: 4 # Maximum number of connections in pool
    use_no_cursor_timeout: false # MongoDB: disable cursor timeout for long operations
    db_name_prefix: "" # Prefix for database names (usually empty)
    run_index_creation: false # Automatically create database indexes on startup

  global_infos_db: # Global information database (system-wide settings)
    connection_str: "connection_string"
    username: "username" # Override with GLOBAL_INFOS_DB_USERNAME
    password: "password" # Override with GLOBAL_INFOS_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  study_db: # Study data database (surveys, responses, etc.)
    connection_str: "connection_string"
    username: "username" # Override with STUDY_DB_USERNAME
    password: "password" # Override with STUDY_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  messaging_db: # Messaging and notifications database
    connection_str: "connection_string"
    username: "username" # Override with MESSAGING_DB_USERNAME
    password: "password" # Override with MESSAGING_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

# List of instance IDs to process messages for
instance_ids: # Study instances that this job will process
  - "default" # Default instance
  - "instance2" # Additional instance

# Messaging service configuration
messaging_configs:
  smtp_bridge_config: # SMTP bridge service configuration
    url: "http://localhost:8080" # URL of the SMTP bridge service
    api_key: "smtp_bridge_api_key" # API key for SMTP bridge (override with SMTP_BRIDGE_API_KEY)
    request_timeout: "90s" # Timeout for requests to SMTP bridge

  global_email_template_constants: # Global constants available in all email templates
    app_name: "App Name" # Application name shown in emails
    support_email: "support@example.com" # Support email address for user inquiries
    base_url: "https://app.com" # Base URL of the application (for links in emails)

# Task execution flags - control which messaging tasks are executed
run_tasks:
  process_outgoing_emails: true # Process and send queued outgoing emails
  schedule_handler: true # Process scheduled message tasks
  study_messages_handler: true # Process study-related messages (study notifications)
  researcher_messages_handler: true # Process researcher notifications

# Timing intervals for various messaging operations
intervals:
  last_send_attempt_lock_duration: "20m" # How long to lock failed send attempts before retry
  login_token_ttl: "168h" # Time-to-live for login tokens (7 days)
  unsubscribe_token_ttl: "8760h" # Time-to-live for unsubscribe tokens (1 year)

# Study engine configuration
study_configs:
  global_secret: "global_secret" # Global secret for study operations (override with STUDY_GLOBAL_SECRET)
```

---

### User Management Job

**Location**: `jobs/user-management/`

#### Environment Variables

| Variable                                         | Description                                    | Type   | Default     |
| ------------------------------------------------ | ---------------------------------------------- | ------ | ----------- |
| `STUDY_DB_USERNAME`                              | Study database username                        | string | from config |
| `STUDY_DB_PASSWORD`                              | Study database password                        | string | from config |
| `PARTICIPANT_USER_DB_USERNAME`                   | Participant user database username             | string | from config |
| `PARTICIPANT_USER_DB_PASSWORD`                   | Participant user database password             | string | from config |
| `GLOBAL_INFOS_DB_USERNAME`                       | Global infos database username                 | string | from config |
| `GLOBAL_INFOS_DB_PASSWORD`                       | Global infos database password                 | string | from config |
| `MESSAGING_DB_USERNAME`                          | Messaging database username                    | string | from config |
| `MESSAGING_DB_PASSWORD`                          | Messaging database password                    | string | from config |
| `SMTP_BRIDGE_API_KEY`                            | SMTP bridge API key                            | string | from config |
| `STUDY_GLOBAL_SECRET`                            | Global secret for study operations             | string | from config |
| `EXTERNAL_SERVICE_API_KEY_FOR_{NORMALIZED_NAME}` | API key for external service (dynamic pattern) | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "user-management.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Database connection configurations
db_configs:
  participant_user_db: # Participant user accounts database
    connection_str: "connection_string" # MongoDB connection string (host:port)
    username: "username" # Database username (override with PARTICIPANT_USER_DB_USERNAME)
    password: "password" # Database password (override with PARTICIPANT_USER_DB_PASSWORD)
    connection_prefix: "" # Connection string prefix (usually empty)
    timeout: 30 # Connection timeout in seconds
    idle_conn_timeout: 45 # Idle connection timeout in seconds
    max_pool_size: 4 # Maximum number of connections in pool
    use_no_cursor_timeout: false # MongoDB: disable cursor timeout for long operations
    db_name_prefix: "" # Prefix for database names (usually empty)
    run_index_creation: false # Automatically create database indexes on startup

  global_infos_db: # Global information database (system-wide settings)
    connection_str: "connection_string"
    username: "username" # Override with GLOBAL_INFOS_DB_USERNAME
    password: "password" # Override with GLOBAL_INFOS_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  study_db: # Study data database (surveys, responses, etc.)
    connection_str: "connection_string"
    username: "username" # Override with STUDY_DB_USERNAME
    password: "password" # Override with STUDY_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  messaging_db: # Messaging and notifications database
    connection_str: "connection_string"
    username: "username" # Override with MESSAGING_DB_USERNAME
    password: "password" # Override with MESSAGING_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

# Messaging service configuration
messaging_configs:
  smtp_bridge_config: # SMTP bridge service configuration
    url: "http://localhost:8080" # URL of the SMTP bridge service
    api_key: "smtp_bridge_api_key" # API key for SMTP bridge (override with SMTP_BRIDGE_API_KEY)
    request_timeout: "90s" # Timeout for requests to SMTP bridge

  global_email_template_constants: # Global constants available in all email templates
    app_name: "App Name" # Application name shown in emails
    support_email: "support@example.com" # Support email address for user inquiries

# Study engine configuration
study_configs:
  global_secret: "global_secret" # Global secret for study operations (override with STUDY_GLOBAL_SECRET)
  external_services:
    [] # External service integrations (API calls from user management)
    # Example external service:
    # - name: "notification-service"    # Service name (used for dynamic env var generation)
    #   url: "https://api.notifications.example.com"  # Service endpoint URL
    #   api_key: "default_key"          # API key (override with EXTERNAL_SERVICE_API_KEY_FOR_NOTIFICATION_SERVICE)
    #   timeout: 30                     # Request timeout in seconds

# User management specific configuration
user_management_config:
  cleanup_config: # Configuration for automatic user cleanup
    delete_inactive_users: true # Enable deletion of inactive users
    inactive_check_interval: "24h" # How often to check for inactive users
    deletion_wait_time: "7d" # How long to wait before deleting inactive users
    send_delete_notification: true # Send notification before deleting users
    notification_config: # Configuration for deletion notifications
      from: "noreply@example.com" # Email address to send notifications from
      subject: "Account Deletion Notice" # Subject line for deletion notifications

  auto_verification_config: # Configuration for automatic verification processes
    email_verification: # Email verification settings
      auto_send_verification: true # Automatically send email verification on registration
      verification_code_lifetime: "24h" # How long verification codes are valid
    phone_verification: # Phone/SMS verification settings
      auto_send_verification: false # Automatically send SMS verification (requires SMS gateway)
```

---

### Study Timer Job

**Location**: `jobs/study-timer/`

#### Environment Variables

| Variable                                         | Description                                    | Type   | Default     |
| ------------------------------------------------ | ---------------------------------------------- | ------ | ----------- |
| `STUDY_DB_USERNAME`                              | Study database username                        | string | from config |
| `STUDY_DB_PASSWORD`                              | Study database password                        | string | from config |
| `STUDY_GLOBAL_SECRET`                            | Global secret for study operations             | string | from config |
| `EXTERNAL_SERVICE_API_KEY_FOR_{NORMALIZED_NAME}` | API key for external service (dynamic pattern) | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "study-timer.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Database connection configurations
db_configs:
  study_db: # Study data database (surveys, responses, etc.)
    connection_str: "connection_string" # MongoDB connection string (host:port)
    username: "username" # Database username (override with STUDY_DB_USERNAME)
    password: "password" # Database password (override with STUDY_DB_PASSWORD)
    connection_prefix: "" # Connection string prefix (usually empty)
    timeout: 30 # Connection timeout in seconds
    idle_conn_timeout: 45 # Idle connection timeout in seconds
    max_pool_size: 4 # Maximum number of connections in pool
    use_no_cursor_timeout: false # MongoDB: disable cursor timeout for long operations
    db_name_prefix: "" # Prefix for database names (usually empty)
    run_index_creation: false # Automatically create database indexes on startup

# List of instance IDs to process timer events for
instance_ids: # Study instances that this job will process
  - "default" # Default instance
  - "research_instance" # Research environment instance
  - "pilot_study" # Pilot study instance

# Study engine configuration
study_configs:
  global_secret: "global_secret" # Global secret for study operations (override with STUDY_GLOBAL_SECRET)
  external_services: # External service integrations for timer actions
    - name: "email-service" # Service name (used for dynamic env var generation)
      url: "https://api.email-provider.com" # Service endpoint URL
      api_key: "email_api_key" # API key (override with EXTERNAL_SERVICE_API_KEY_FOR_EMAIL_SERVICE)
      timeout: 30 # Request timeout in seconds
    - name: "notification-webhook" # Webhook service for notifications
      url: "https://webhook.notification-service.com"
      api_key: "webhook_key" # Override with EXTERNAL_SERVICE_API_KEY_FOR_NOTIFICATION_WEBHOOK
      timeout: 15
    - name: "sms-gateway" # SMS service for text notifications
      url: "https://api.sms-gateway.com"
      api_key: "sms_key" # Override with EXTERNAL_SERVICE_API_KEY_FOR_SMS_GATEWAY
      timeout: 20

# Cleanup configuration for orphaned files
clean_up_config:
  filestore_path: "/path/to/filestore" # Path to filestore directory for cleanup
  clean_orphaned_task_results: true # Enable cleanup of orphaned task result files
```

---

### Study Daily Data Export Job

**Location**: `jobs/study-daily-data-export/`

#### Environment Variables

| Variable                                                     | Description                                                        | Type   | Default     |
| ------------------------------------------------------------ | ------------------------------------------------------------------ | ------ | ----------- |
| `STUDY_DB_USERNAME`                                          | Study database username                                            | string | from config |
| `STUDY_DB_PASSWORD`                                          | Study database password                                            | string | from config |
| `CONF_RESP_EXPORT_STUDY_GLOBAL_SECRET_FOR_{NORMALIZED_NAME}` | Study global secret for confidential export task (dynamic pattern) | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "study-export.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Database connection configurations
db_configs:
  study_db: # Study data database (surveys, responses, etc.)
    connection_str: "connection_string" # MongoDB connection string (host:port)
    username: "username" # Database username (override with STUDY_DB_USERNAME)
    password: "password" # Database password (override with STUDY_DB_PASSWORD)
    connection_prefix: "" # Connection string prefix (usually empty)
    timeout: 30 # Connection timeout in seconds
    idle_conn_timeout: 45 # Idle connection timeout in seconds
    max_pool_size: 4 # Maximum number of connections in pool
    use_no_cursor_timeout: false # MongoDB: disable cursor timeout for long operations
    db_name_prefix: "" # Prefix for database names (usually empty)
    run_index_creation: false # Automatically create database indexes on startup

# Export path for generated files
export_path: "/path/to/export/directory" # Directory where export files will be stored (must exist)

# Survey response exports configuration
response_exports:
  retention_days: 30 # How many days to keep old export files
  override_old: true # Overwrite existing export files with same name
  export_tasks: # List of export tasks to perform
    - instance_id: "default" # Instance ID for this export task
      study_key: "study1" # Study key to export data from
      survey_keys: # List of specific surveys to export
        - "weekly_survey" # Survey key 1
        - "monthly_survey" # Survey key 2
      extra_context_columns: [] # Additional context columns to include (if available)
      export_format: "csv" # Export format: csv or json
      separator: "-" # Date separator in filename (YYYY-MM-DD)
      short_keys: false # Use short keys in column headers (reduces file size)
      create_empty_file: false # Create empty file even if no data exists
    - instance_id: "research_instance" # Second export task
      study_key: "covid_study"
      survey_keys:
        - "symptoms_survey"
        - "vaccination_survey"
      extra_context_columns: # Include additional context columns
        - "location" # Location context if available
      export_format: "json" # Export in JSON format
      separator: "-"
      short_keys: true # Use shortened column names
      create_empty_file: true # Always create file, even if empty

# Confidential response exports configuration (encrypted/sensitive data)
conf_resp_exports:
  preserve_previous_files: false # Keep previous export files (don't overwrite)
  export_tasks: # List of confidential export tasks
    - name: "patient-data" # Task name (used for env var generation)
      instance_id: "default" # Instance ID for this export
      study_key: "sensitive_study" # Study containing sensitive data
      study_global_secret: "default_secret" # Global secret (override with CONF_RESP_EXPORT_STUDY_GLOBAL_SECRET_FOR_PATIENT_DATA)
      resp_key_filter: # Filter to specific response keys (optional)
        - "personal_data.Q1" # Only export this response key
      export_format: "csv" # Export format for confidential data
    - name: "trial-results" # Second confidential export task
      instance_id: "research_instance"
      study_key: "clinical_trial"
      study_global_secret: "clinical_secret" # Override with CONF_RESP_EXPORT_STUDY_GLOBAL_SECRET_FOR_TRIAL_RESULTS
      resp_key_filter: [] # Empty = export all response keys
      export_format: "json"

# Cleanup configuration for orphaned files
clean_up_config:
  clean_orphaned_task_results: true # Enable cleanup of orphaned task result files
  filestore_root: "/path/to/filestore" # Root path of filestore for cleanup
  instance_ids: # Instance IDs to clean up
    - "default" # Clean up default instance
    - "research_instance" # Clean up research instance
```

---

### DB Migration Job

**Location**: `jobs/db-migration/`

#### Environment Variables

| Variable                       | Description                        | Type   | Default     |
| ------------------------------ | ---------------------------------- | ------ | ----------- |
| `STUDY_DB_USERNAME`            | Study database username            | string | from config |
| `STUDY_DB_PASSWORD`            | Study database password            | string | from config |
| `PARTICIPANT_USER_DB_USERNAME` | Participant user database username | string | from config |
| `PARTICIPANT_USER_DB_PASSWORD` | Participant user database password | string | from config |
| `MANAGEMENT_USER_DB_USERNAME`  | Management user database username  | string | from config |
| `MANAGEMENT_USER_DB_PASSWORD`  | Management user database password  | string | from config |
| `GLOBAL_INFOS_DB_USERNAME`     | Global infos database username     | string | from config |
| `GLOBAL_INFOS_DB_PASSWORD`     | Global infos database password     | string | from config |
| `MESSAGING_DB_USERNAME`        | Messaging database username        | string | from config |
| `MESSAGING_DB_PASSWORD`        | Messaging database password        | string | from config |

#### YAML Configuration Structure

```yaml
# Logging configuration - same as other services
logging:
  log_level: "info" # Logging level: debug, info, warn, error
  include_src: true # Include source file info in log entries
  log_to_file: true # Write logs to file (not just stdout)
  filename: "db-migration.log" # Name of the log file
  max_size: 100 # Maximum log file size in MB before rotation
  max_age: 28 # Maximum age of log files in days
  max_backups: 3 # Maximum number of old log files to keep
  compress_old_logs: true # Compress rotated log files to save space
  include_build_info: "once" # Include build info: never, once (at startup), always

# Database connection configurations (all databases for migration)
db_configs:
  study_db: # Study data database (surveys, responses, etc.)
    connection_str: "connection_string" # MongoDB connection string (host:port)
    username: "username" # Database username (override with STUDY_DB_USERNAME)
    password: "password" # Database password (override with STUDY_DB_PASSWORD)
    connection_prefix: "" # Connection string prefix (usually empty)
    timeout: 30 # Connection timeout in seconds
    idle_conn_timeout: 45 # Idle connection timeout in seconds
    max_pool_size: 4 # Maximum number of connections in pool
    use_no_cursor_timeout: false # MongoDB: disable cursor timeout for long operations
    db_name_prefix: "" # Prefix for database names (usually empty)
    run_index_creation: false # Automatically create database indexes on startup

  participant_user_db: # Participant user accounts database
    connection_str: "connection_string"
    username: "username" # Override with PARTICIPANT_USER_DB_USERNAME
    password: "password" # Override with PARTICIPANT_USER_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  management_user_db: # Management user accounts database
    connection_str: "connection_string"
    username: "username" # Override with MANAGEMENT_USER_DB_USERNAME
    password: "password" # Override with MANAGEMENT_USER_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  global_infos_db: # Global information database (system-wide settings)
    connection_str: "connection_string"
    username: "username" # Override with GLOBAL_INFOS_DB_USERNAME
    password: "password" # Override with GLOBAL_INFOS_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

  messaging_db: # Messaging and notifications database
    connection_str: "connection_string"
    username: "username" # Override with MESSAGING_DB_USERNAME
    password: "password" # Override with MESSAGING_DB_PASSWORD
    connection_prefix: ""
    timeout: 30
    idle_conn_timeout: 45
    max_pool_size: 4
    use_no_cursor_timeout: false
    db_name_prefix: ""
    run_index_creation: false

# Migration tasks configuration
migration_tasks:
  drop_indexes: # Index dropping configuration
    mode: "none" # Global mode: "all" (drop all), "defaults" (drop defaults), "none" (don't drop)
    study_db: "defaults" # Per-database override: drop default indexes from study_db
    participant_user_db: "defaults" # Per-database override: drop default indexes from participant_user_db
    management_user_db: "defaults" # Per-database override: drop default indexes from management_user_db
    global_infos_db: "defaults" # Per-database override: drop default indexes from global_infos_db
    messaging_db: "defaults" # Per-database override: drop default indexes from messaging_db

  create_indexes: # Index creation configuration
    study_db: true # Create indexes for study database
    participant_user_db: true # Create indexes for participant user database
    management_user_db: true # Create indexes for management user database
    global_infos_db: true # Create indexes for global infos database
    messaging_db: true # Create indexes for messaging database

  migration_tasks_config: # Specific migration tasks
    participant_user_contact_infos_fix: false # Fix participant user contact info data structure
```

---

## Dynamic Environment Variable Generation

The system automatically generates environment variable names for certain configurations using normalization rules.

### Normalization Rules

1. Convert to uppercase
2. Replace non-alphanumeric characters with underscores
3. Remove leading/trailing underscores

### External Service API Keys

**Pattern**: `EXTERNAL_SERVICE_API_KEY_FOR_{NORMALIZED_NAME}`

**Examples**:

- Service name: `"notification-api_v2"` → `EXTERNAL_SERVICE_API_KEY_FOR_NOTIFICATION_API_V2`
- Service name: `"webhook-handler"` → `EXTERNAL_SERVICE_API_KEY_FOR_WEBHOOK_HANDLER`

### SMTP Server Credentials

**Patterns**:

- Username: `SMTP_SERVER_USERNAME_FOR_{NORMALIZED_HOST}_{NORMALIZED_PORT}`
- Password: `SMTP_SERVER_PASSWORD_FOR_{NORMALIZED_HOST}_{NORMALIZED_PORT}`

**Examples**:

- SMTP server: `smtp.gmail.com:587` →
  - `SMTP_SERVER_USERNAME_FOR_SMTP_GMAIL_COM_587`
  - `SMTP_SERVER_PASSWORD_FOR_SMTP_GMAIL_COM_587`

### Confidential Export Task Secrets

**Pattern**: `CONF_RESP_EXPORT_STUDY_GLOBAL_SECRET_FOR_{NORMALIZED_NAME}`

**Examples**:

- Task name: `"patient-data"` → `CONF_RESP_EXPORT_STUDY_GLOBAL_SECRET_FOR_PATIENT_DATA`
- Task name: `"weekly report"` → `CONF_RESP_EXPORT_STUDY_GLOBAL_SECRET_FOR_WEEKLY_REPORT`

---
